resources:
- repo: self

trigger:
  branches:
    include:
      - '*'

variables: 
  NUGET_PACKAGES: $(Pipeline.Workspace)/.nuget/packages

pool:
  vmImage: windows-2022

steps:
  # - task: CacheBeta@0
  #   displayName: Cache NuGet packages
  #   inputs:
  #     key: nuget | ./src/Plugin.Fingerprint/packages.lock.json
  #     path: $(NUGET_PACKAGES)

  - task: CmdLine@2
    inputs:
      script: 'dotnet workload install maui'
  
  - task: DotNetCoreCLI@2
    displayName: Restore Packages
    inputs:
      command: 'restore'
      projects: './src/Build.sln'
      feedsToUse: 'select'

  - task: MSBuild@1
    displayName: Build & Package
    inputs:
      solution: ./src/Build.sln
      msbuildArguments: /restore /t:build /p:CreatePackage=true /p:ContinuousIntegrationBuild=true /p:PackageOutputPath=$(Build.ArtifactStagingDirectory)\artifacts
      configuration: Release
      maximumCpuCount: true

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: $(Build.ArtifactStagingDirectory)\artifacts
      ArtifactName: artifacts
      publishLocation: Container
    condition: always()
